---
import Layout from "../../layouts/Layout.astro";
import ProjectHero from "../../components/ProjectHero.astro";
import Projects from "../../components/Projects.astro";
import ProjectGallery from "../../components/ProjectGallery.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import i18next from "../../i18n/config";

export function getStaticPaths() {
    return [
        { params: { lang: "hr" } },
        { params: { lang: "en" } },
        { params: { lang: "sl" } },
        { params: { lang: "de" } },
        { params: { lang: "it" } },
        { params: { lang: "hu" } },
    ];
}

const { lang } = Astro.params;

// Change language before rendering
if (lang) {
    await i18next.changeLanguage(lang);
}

const pageTitle = `Solar Fusion - ${i18next.t("nav.projects")}`;
const pageDescription =
    i18next.t("meta.projects.description") ||
    "Explore our portfolio of solar energy projects across Croatia. View residential, commercial and agricultural installations.";
---

<Layout title={pageTitle} description={pageDescription}>
    <Breadcrumbs />
    <ProjectHero />
    <Projects
        client:load
        viewAllText={i18next.t("projects.viewAll")}
        hideAllText={i18next.t("projects.hideAll") ?? "Sakrij Projekte"}
    />

    <div class="text-center my-6">
        <button
            id="toggleGalleryBtn"
            class="bg-secondary hover:bg-secondary/90 text-white font-bold py-3 px-6 rounded-xl transition-all inline-flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
            aria-expanded="false">
            <span>{i18next.t("projects.viewAll")}</span>
            <svg
                class="w-5 h-5 transition-transform duration-300 transform rotate-0"
                id="chevronIcon"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>
    </div>

    <div id="projectGalleryContainer" class="hidden">
        <ProjectGallery />
    </div>
</Layout>

<script
    define:vars={{
        viewAllText: i18next.t("projects.viewAll"),
        hideAllText: i18next.t("projects.hideAll") ?? "Sakrij Projekte",
    }}
>
    // Toggle gallery visibility when button is clicked
    document.addEventListener("astro:page-load", () => {
        const toggleBtn = document.getElementById("toggleGalleryBtn");
        const galleryContainer = document.getElementById(
            "projectGalleryContainer"
        );

        if (toggleBtn && galleryContainer) {
            toggleBtn.addEventListener("click", () => {
                // Toggle visibility
                galleryContainer.classList.toggle("hidden");

                // Change button text based on current state
                if (galleryContainer.classList.contains("hidden")) {
                    toggleBtn.textContent = viewAllText;
                } else {
                    toggleBtn.textContent = hideAllText;
                }

                // Scroll to gallery if becoming visible
                if (!galleryContainer.classList.contains("hidden")) {
                    galleryContainer.scrollIntoView({ behavior: "smooth" });
                }
            });
        }
    });
</script>
