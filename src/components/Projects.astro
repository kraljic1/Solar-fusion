---
import { t as tFunc } from "i18next";
import i18next from "../i18n/config";

const { lang = "hr" } = Astro.params;

// Change language before rendering
if (lang) {
    await i18next.changeLanguage(lang);
}

const projects = [
    {
        title: tFunc("projects.gallery.project1.title"),
        description: tFunc("projects.gallery.project1.description"),
        image: "https://assets.cdn.filesafe.space/M4krpnwvjmupM7QGr4NX/media/67b2a91fafe6ae4deaaa5ebe.png",
        details: {
            power: "10kW",
            panels: "25",
            savings: "90%",
            completed: "2023",
        },
    },
    {
        title: tFunc("projects.gallery.project2.title"),
        description: tFunc("projects.gallery.project2.description"),
        image: "https://images.unsplash.com/photo-1545209463-e2825498edbf?ixlib=rb-1.2.1&auto=format&fit=crop&w=1074&q=80",
        details: {
            power: "50kW",
            panels: "125",
            savings: "75%",
            completed: "2022",
        },
    },
    {
        title: tFunc("projects.gallery.project3.title"),
        description: tFunc("projects.gallery.project3.description"),
        image: "https://images.unsplash.com/photo-1613665813446-82a78c468a1d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1074&q=80",
        details: {
            power: "25kW",
            panels: "60",
            savings: "60%",
            completed: "2023",
        },
    },
    {
        title: tFunc("projects.gallery.project4.title"),
        description: tFunc("projects.gallery.project4.description"),
        image: "https://images.unsplash.com/photo-1523438885200-e635ba2c371e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1074&q=80",
        details: {
            power: "75kW",
            panels: "180",
            savings: "80%",
            completed: "2022",
        },
    },
];

// Function to create a slug from a title
const createSlug = (title: string) => {
    return title
        .toLowerCase()
        .replace(/[^\w\s-]/g, "") // Remove special characters
        .replace(/\s+/g, "-") // Replace spaces with hyphens
        .trim();
};

interface Translations {
    title: string;
    description: string;
    power: string;
    panels: string;
    savings: string;
    year: string;
}

interface TranslationsMap {
    hr: Translations;
    en: Translations;
    sl: Translations;
    de: Translations;
    it: Translations;
    hu: Translations;
    [key: string]: Translations;
}

const translations: TranslationsMap = {
    hr: {
        title: "Naši Projekti",
        description:
            "Pogledajte neke od naših uspješno realiziranih projekata solarnih sustava",
        power: "Snaga sustava",
        panels: "Broj panela",
        savings: "Ušteda",
        year: "Godina",
    },
    en: {
        title: "Our Projects",
        description:
            "Take a look at some of our successfully completed solar system projects",
        power: "System Power",
        panels: "Number of Panels",
        savings: "Savings",
        year: "Year",
    },
    sl: {
        title: "Naši Projekti",
        description:
            "Oglejte si nekaj naših uspešno izvedenih projektov solarnih sistemov",
        power: "Moč sistema",
        panels: "Število panelov",
        savings: "Prihranek",
        year: "Leto",
    },
    de: {
        title: "Unsere Projekte",
        description:
            "Sehen Sie sich einige unserer erfolgreich realisierten Solarsystemprojekte an",
        power: "Systemleistung",
        panels: "Anzahl der Module",
        savings: "Einsparung",
        year: "Jahr",
    },
    it: {
        title: "I Nostri Progetti",
        description:
            "Dai uno sguardo ad alcuni dei nostri progetti di sistemi solari completati con successo",
        power: "Potenza Sistema",
        panels: "Numero Pannelli",
        savings: "Risparmio",
        year: "Anno",
    },
    hu: {
        title: "Projektjeink",
        description:
            "Tekintse meg néhány sikeresen megvalósított napelemes rendszer projektünket",
        power: "Rendszer Teljesítmény",
        panels: "Panelek Száma",
        savings: "Megtakarítás",
        year: "Év",
    },
};

const t = translations[lang as keyof typeof translations] || translations.hr;
---

<section class="pt-40 pb-20 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
            <h1 class="text-4xl font-bold text-primary mb-4">{t.title}</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                {t.description}
            </p>
        </div>

        <!-- Navigation Menu -->
        <div class="mb-16">
            <nav
                class="flex flex-wrap justify-center gap-4"
                aria-label="Project navigation">
                {
                    projects.map((project) => (
                        <a
                            href={`#${createSlug(project.title)}`}
                            class="project-nav-link px-6 py-3 bg-white rounded-lg shadow-sm text-primary hover:bg-primary hover:text-white transition-all duration-300 transform hover:scale-105">
                            {project.title}
                        </a>
                    ))
                }
            </nav>
        </div>

        <div class="grid gap-24">
            {
                projects.map((project, index) => (
                    <div
                        id={createSlug(project.title)}
                        class={`grid md:grid-cols-2 gap-8 items-center scroll-mt-32 ${index % 2 === 1 ? "md:grid-flow-dense" : ""}`}>
                        <div
                            class={`space-y-6 ${index % 2 === 1 ? "md:col-start-2" : ""}`}>
                            <h2 class="text-3xl font-bold text-primary">
                                {project.title}
                            </h2>
                            <p class="text-gray-600 text-lg">
                                {project.description}
                            </p>

                            <div class="mt-4 grid grid-cols-2 gap-2">
                                <div class="flex flex-col">
                                    <span class="text-xs text-gray-500">
                                        {tFunc("projects.details.power")}
                                    </span>
                                    <span class="font-medium">
                                        {project.details.power}
                                    </span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-gray-500">
                                        {tFunc("projects.details.panels")}
                                    </span>
                                    <span class="font-medium">
                                        {project.details.panels}
                                    </span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-gray-500">
                                        {tFunc("projects.details.savings")}
                                    </span>
                                    <span class="font-medium">
                                        {project.details.savings}
                                    </span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-gray-500">
                                        {tFunc("projects.details.completed")}
                                    </span>
                                    <span class="font-medium">
                                        {project.details.completed}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class={index % 2 === 1 ? "md:col-start-1" : ""}>
                            <img
                                src={project.image}
                                alt={project.title}
                                class="w-full h-[400px] object-cover rounded-lg shadow-xl transform transition-transform duration-300 hover:scale-105"
                                loading="lazy"
                            />
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<script>
    function initializeProjectNavigation() {
        // Smooth scrolling for project navigation links
        document.querySelectorAll(".project-nav-link").forEach((anchor) => {
            anchor.addEventListener(
                "click",
                function (this: HTMLElement, e: Event) {
                    e.preventDefault();
                    const href = this.getAttribute("href");
                    if (href) {
                        const target = document.querySelector(href);
                        if (target) {
                            const navHeight =
                                document.querySelector("nav")?.offsetHeight ||
                                0;
                            const targetPosition =
                                target.getBoundingClientRect().top +
                                window.pageYOffset;
                            const offsetPosition = targetPosition - navHeight;

                            window.scrollTo({
                                behavior: "smooth",
                                top: offsetPosition,
                            });

                            // Update URL without scrolling
                            history.pushState(null, "", href);
                        }
                    }
                }
            );
        });

        // Highlight active section on scroll
        const observerOptions = {
            root: null,
            rootMargin: "-50% 0px",
            threshold: 0,
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                const id = entry.target.id;
                const menuItem = document.querySelector(
                    `.project-nav-link[href="#${id}"]`
                );

                if (entry.isIntersecting) {
                    menuItem?.classList.add(
                        "bg-primary",
                        "text-white",
                        "scale-105"
                    );
                    menuItem?.classList.remove("bg-white", "text-primary");
                } else {
                    menuItem?.classList.remove(
                        "bg-primary",
                        "text-white",
                        "scale-105"
                    );
                    menuItem?.classList.add("bg-white", "text-primary");
                }
            });
        }, observerOptions);

        document.querySelectorAll("[id]").forEach((section) => {
            observer.observe(section);
        });
    }

    // Initialize on page load
    initializeProjectNavigation();

    // Handle Astro page transitions
    document.addEventListener("astro:page-load", () => {
        initializeProjectNavigation();
    });
</script>
